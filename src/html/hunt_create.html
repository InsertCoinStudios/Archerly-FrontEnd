<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../css/style.css">
  </head>
  <body>
    <div class="header-bg">
          <img src="../img/return.png" class="header-img" id="returnBtn">
    </div>
    <div class="bg-wrapper">
    <div class="bg-dark">
    </div>
    <div class="bg-wrapper-2">
    <div class="bg-light">

    </div>
    </div>
    </div>
    <div class="container">
      <div class="bg-wrapper-header">
      <div class="header" style="margin-bottom: -10px;">
        <h1>Jagd erstellen</h1>
      </div>
      </div>
        <div class="content">
          <div class="session-box_create">
            <div class="session-box-in_create">
              <h4>SESSION-ID:<br><br></h4>
              <h4 id="s-id">#1234 <img src="../img/copy.svg" onclick="copySessionID()"></h4>
              <!-- DYNAMISCHER WERT NICHT HARD GECODED WIE HIER-->
            </div>
          </div>
        <div class="table_users_queue">
          <!-- DYNAMISCHE ANPASSUNG: USERNAMEN, USERANZAHL -->
          <div class="non-collapse-top_queue">
            <p>User 1</p>
          </div>
          <div class="non-collapse_queue">
            <p>User 2</p>
          </div>
          <div class="non-collapse_queue">
            <p>User 3</p>
          </div>
          <div class="non-collapse_queue">
            <p>User 4</p>
          </div>
          <div class="non-collapse_queue">
            <p>User 5</p>
          </div>
          <div class="non-collapse_queue">
            <p>User 6</p>
          </div>
          <div class="non-collapse_queue">
            <p>User 7</p>
          </div>
          <div class="non-collapse-bottom_queue">
            <p>User 8</p>
          </div>
        </div>
        </div>
      <div class="footer">
        <h5 style="color: #4f4e4e; margin-top: -10px;">
          Teilnehmer Anzahl:<br>8
        </h5>
        <a href="parcour_list.html">
          <button class="blue-btn">Weiter</button>
        </a>
      </div>
    </div>
<div id="leaveOverlay">
  <div id="leaveModal">
    <h3><strong>Möchtest du diese<br>Jagd auflösen?</strong></h3>

    <div class="leave-actions">
      <button id="leaveYes">Ja</button>
      <button id="leaveNo">Nein</button>
    </div>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", async () => {
  const sessionIdEl = document.getElementById("s-id");
  const queueContainer = document.querySelector(".table_users_queue");

  try {
    // JWT aus localStorage holen
    const token = localStorage.getItem("authToken");
    if (!token) throw new Error("Nicht eingeloggt");

    // === Session erstellen ===
    const response = await fetch("https://dein-backend-url/api/session/create", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`
      },
      body: JSON.stringify({ maxPlayers: 8 })
    });

    if (!response.ok) throw new Error("Fehler beim Erstellen der Session");

    const data = await response.json();

    // Session-ID anzeigen
    if (data.sessionId) {
      sessionIdEl.innerHTML = `#${data.sessionId} <img src="../img/copy.svg" onclick="copySessionID()">`;
    } else {
      sessionIdEl.innerHTML = "#XXXX <img src='../img/copy.svg' onclick='copySessionID()'>";
    }

    // === Spieler-Tabelle dynamisch aufbauen ===
    // Beispiel: data.players = [{id:1,name:"User 1"},{id:2,name:"User 2"},...]
    // data.creatorId = ID des Users, der die Session erstellt hat
    queueContainer.innerHTML = ""; // vorher leeren

    data.players.forEach((player, idx) => {
      const div = document.createElement("div");

      // Klassen für obere/untere Ränder
      if (idx === 0) div.className = "non-collapse-top_queue";
      else if (idx === data.players.length - 1) div.className = "non-collapse-bottom_queue";
      else div.className = "non-collapse_queue";

      div.innerHTML = `<p>${player.name}</p>`;

      // === Highlight für Creator ===
      if (player.id === data.creatorId) {
        div.style.backgroundColor = "#fbd279"; // gelb
        div.style.fontStyle = "italic";
      }

      queueContainer.appendChild(div);
    });

  } catch (err) {
    console.error(err);
    alert("Fehler beim Erstellen der Session oder Laden der Spieler.");
  }
});
</script>


<script>
const returnBtn = document.getElementById("returnBtn");
const overlay = document.getElementById("leaveOverlay");
const yesBtn = document.getElementById("leaveYes");
const noBtn = document.getElementById("leaveNo");

// Session-ID aus DOM auslesen
const sessionIdEl = document.getElementById("s-id");

// Klick auf "Zurück"-Button
returnBtn.addEventListener("click", () => {
  overlay.style.display = "flex";
});

// Klick auf "Ja" → Session löschen
yesBtn.addEventListener("click", async () => {
  const sessionId = sessionIdEl.innerText.split(" ")[0].replace("#", ""); // z.B. "1234"

  try {
    const token = localStorage.getItem("authToken");
    if (!token) throw new Error("Nicht eingeloggt");

    // === Anfrage ans Backend: Session löschen ===
    const response = await fetch(`https://dein-backend-url/api/session/${sessionId}`, {
      method: "DELETE",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`
      }
    });

    if (!response.ok) throw new Error("Fehler beim Löschen der Session");

    // Erfolgreich gelöscht → zurück zur Index-Seite
    window.location.href = "index.html";

  } catch (err) {
    console.error(err);
    alert("Fehler beim Auflösen der Session. Bitte später erneut versuchen.");
  }
});

// Klick auf "Nein" → Overlay schließen
noBtn.addEventListener("click", () => {
  overlay.style.display = "none";
});

// Overlay schließen, wenn außerhalb geklickt wird
overlay.addEventListener("click", (e) => {
  if (e.target === overlay) overlay.style.display = "none";
});
</script>

  </body>
</html>