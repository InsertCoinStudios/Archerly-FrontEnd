<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../css/style.css">
  </head>
  <body>
    <div class="header-bg">
      <a href="admin_main.html"><img src="../img/return.png" class="header-img"></a>
      <img src="../img/trash.png" class="header-img-2" id="deleteBtn">
    </div>
    <div class="bg-wrapper">
    <div class="bg-dark-admin">
    </div>
    <div class="bg-wrapper-2">
    <div class="bg-light-admin">

    </div>
    </div>
    </div>
    <div class="container">
    <div class="bg-wrapper-header">
  <div class="header-admin">
    <h1>
      Erstellen
    </h1>
      <form id="loginForm">

      <div class="data-input-admin">
      <label for="parcour-name" class="label-admin">Parkour:</label>
      <input type="text" id ="parcour-name" name="parcour-name" placeholder="Safari - Route" class="textbox-admin">
      </div>

      <div class="data-input-admin">
      <label for="parcour-loc" class="label-admin">Ort:</label>
      <input type="text" id="parcour-loc" name="parcour-loc" placeholder="W√ºste 02" class="textbox-admin">
      </div>

  </form>
  </div>
  </div>

      <div class="content-top">
          <div style="text-align: left; margin-left: 20px;">
            <br>

            <p>Schwierigkeit:</p>
              <div class="radio-btns">
                <input type="radio" id="easy" name="difficulty" value="easy">
                <label for="easy">Leicht</label>
                <input type="radio" id="middle" name="difficulty" value="middle">
                <label for="middle">Mittel</label>
                <input type="radio" id="hard" name="difficulty" value="hard">
                <label for="hard">Schwer</label>
              </div>
          </div>
          <p class="divider"></p>
      </div>
      <div class="content">
        <div class="table-header">
          <p class="left">Tiere</p>
          <p class="right">
            <!-- DYNAMISCHER WERT:
             LIEST DIE ANZAHL DER TIERE IN DER TABELLE AUS
             ERLAUBT ES NICHT WENIGER, ALS DIE FIX GESETZTE ANZAHL ZU MANIPULIEREN (DAS TIER MUSS EXTRA PER KLICK GEL√ñSCHT WERDEN)
             ERLAUBT ES TIERE HINZUZUF√úGEN, JEDOCH MUSS DER DATENSATZ FIX BEARBEITET WERDEN-->
            Anzahl:
            <input type="number" class="animal-counter" name="counter" min="1" max="100">
          </p>
        </div>
        <div class="table_users_admin-editor">
          <!-- DYNAMISCHE ANPASSUNG: USERNAMEN, USERANZAHL -->
          <div class="non-collapse-top-admin">
            <span class="drag-handle">&#x2630;</span>
            <span class="animal-text">Tier</span>
            <a href="admin_animal.html"><img class="edit_png" src="../img/edit_square.png" alt="edit"></a>
          </div>
          <div class="non-collapse-admin">
            <span class="drag-handle">&#x2630;</span>
            <span class="animal-text">Tier</span>
            <a href="admin_animal.html"><img class="edit_png" src="../img/edit_square.png" alt="edit"></a>
          </div>
          <div class="non-collapse-bottom-admin">
            <span class="drag-handle">&#x2630;</span>
            <span class="animal-text">Tier</span>
            <a href="admin_animal.html"><img class="edit_png" src="../img/edit_square.png" alt="edit"></a>
          </div>
        </div>
        <button class="blue-btn-admin" id="saveBtn" style="float: right; margin: 10px;">
  Speichern
</button>

      </div>
    </div>
        <div class="target-circle" id="register_2-admin">
          <span class="circle1">
            <span class="circle2">
              <span class="circle3">
                <span class="circle4">
                  <span class="circle5">
                    <span class="circle6">
                    </span>
                  </span>
                </span>
              </span>
            </span>
          </span>
        </div>
<div id="leaveOverlay">
  <div id="leaveModal">
    <h3><strong>M√∂chtest du wirklich<br>diesen Parkour l√∂schen?</strong></h3>

    <div class="leave-actions">
      <button id="leaveYes">Ja</button>
      <button id="leaveNo">Nein</button>
    </div>
  </div>
</div>
<script>
  const deleteBtn = document.getElementById("deleteBtn");
  const overlay = document.getElementById("leaveOverlay");
  const yesBtn = document.getElementById("leaveYes");
  const noBtn = document.getElementById("leaveNo");

  deleteBtn.addEventListener("click", () => {
    overlay.style.display = "flex";
  });

  yesBtn.addEventListener("click", () => {
    window.location.href = "admin_main.html";
  });

  noBtn.addEventListener("click", () => {
    overlay.style.display = "none";
  });

  overlay.addEventListener("click", (e) => {
  if (e.target === overlay) {
    overlay.style.display = "none";
  }
});

</script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
  // =========================
  // BASIS-ELEMENTE
  // =========================
  const animalList = document.querySelector('.table_users_admin-editor');
  const animalCounter = document.querySelector('.animal-counter');

  // =========================
  // SORTABLE.JS
  // =========================
  const sortable = Sortable.create(animalList, {
    animation: 150,
    ghostClass: 'sortable-ghost',
    handle: '.drag-handle',
    forceFallback: true,
    onEnd: refreshRowClasses
  });

  // =========================
  // KLASSEN KORREKT SETZEN
  // =========================
  function refreshRowClasses() {
    const rows = animalList.children;

    Array.from(rows).forEach(row => {
      row.classList.remove(
        'non-collapse-top-admin',
        'non-collapse-bottom-admin',
        'non-collapse-admin'
      );
      row.classList.add('non-collapse-admin');
    });

    if (rows.length > 0) {
      rows[0].classList.replace('non-collapse-admin', 'non-collapse-top-admin');
      rows[rows.length - 1].classList.replace('non-collapse-admin', 'non-collapse-bottom-admin');
    }
  }

  // =========================
  // REIHENFOLGE AUSLESEN
  // =========================
  function getAnimalOrder() {
    return Array.from(
      animalList.querySelectorAll('.animal-text')
    ).map(el => el.innerText.trim());
  }

  saveBtn.addEventListener('click', () => {
    console.log('Neue Reihenfolge:', getAnimalOrder());
  });

  // =========================
  // COUNTER + ADD-LOGIC
  // =========================

  let minAnimals = animalList.children.length;
  let currentAnimals = minAnimals;

  // Initial Counter setzen
  animalCounter.value = minAnimals;
  animalCounter.min = minAnimals;

  // Neue Tier-Zeile
  function createAnimalRow(name = 'Tier') {
    const div = document.createElement('div');
    div.className = 'non-collapse-admin';
    div.innerHTML = `
      <span class="drag-handle">&#x2630;</span>
      <span class="animal-text">${name}</span>
      <a href="admin_animal.html">
        <img class="edit_png" src="../img/edit_square.png" alt="edit">
      </a>
    `;
    return div;
  }

  // Counter-√Ñnderung
  animalCounter.addEventListener('input', () => {
    const target = parseInt(animalCounter.value, 10);

    // ‚ùå Reduzieren verboten
    if (target < minAnimals) {
      animalCounter.value = currentAnimals;
      return;
    }

    // ‚ûï Tiere hinzuf√ºgen
    if (target > currentAnimals) {
      const toAdd = target - currentAnimals;

      for (let i = 0; i < toAdd; i++) {
        animalList.appendChild(createAnimalRow());
      }

    currentAnimals = animalList.children.length;
    minAnimals = currentAnimals;      // ‚≠ê WICHTIG
    animalCounter.min = minAnimals;   // ‚≠ê UI absichern
    animalCounter.value = currentAnimals;

    refreshRowClasses();

    }
  });

  // Initial korrekt setzen
  refreshRowClasses();

</script>
<script>
  // =========================
  // FORM ELEMENTE
  // =========================
  const nameInput = document.getElementById("parcour-name");
  const locInput = document.getElementById("parcour-loc");
  const difficultyRadios = document.querySelectorAll('input[name="difficulty"]');
  const saveBtn = document.getElementById("saveBtn");

  // =========================
  // BUTTON INITIAL DEAKTIVIEREN
  // =========================
  disableSave();

  function disableSave() {
    saveBtn.disabled = true;
    saveBtn.style.opacity = "0.5";
    saveBtn.style.pointerEvents = "none";
  }

  function enableSave() {
    saveBtn.disabled = false;
    saveBtn.style.opacity = "1";
    saveBtn.style.pointerEvents = "auto";
  }

  // =========================
  // VALIDIERUNG
  // =========================
  function validateSave() {
    const nameOk = nameInput.value.trim() !== "";
    const locOk = locInput.value.trim() !== "";

    const difficultyOk = Array.from(difficultyRadios).some(r => r.checked);

    const animals = Array.from(
      document.querySelectorAll(".animal-text")
    ).map(a => a.innerText.trim());

    const hasAnimals = animals.length > 0;
    const hasInvalidAnimal = animals.some(
      name => name === "" || name.toLowerCase() === "tier"
    );

    if (nameOk && locOk && difficultyOk && hasAnimals && !hasInvalidAnimal) {
      enableSave();
    } else {
      disableSave();
    }
  }

  // =========================
  // EVENTS
  // =========================
  nameInput.addEventListener("input", validateSave);
  locInput.addEventListener("input", validateSave);
  difficultyRadios.forEach(r => r.addEventListener("change", validateSave));

  // Wenn Tiere hinzugef√ºgt / sortiert werden
  const observer = new MutationObserver(validateSave);
  observer.observe(document.querySelector(".table_users_admin-editor"), {
    childList: true,
    subtree: true,
    characterData: true
  });

  // =========================
  // SPEICHERN KLICK
  // =========================
  saveBtn.addEventListener("click", () => {
    const animals = Array.from(
      document.querySelectorAll(".animal-text")
    ).map(a => a.innerText.trim());

    if (animals.some(a => a.toLowerCase() === "tier")) {
      alert("Bitte alle Tiere benennen!");
      return;
    }

    alert("‚úÖ Parkour erfolgreich gespeichert!");
    // üëâ hier sp√§ter echtes Backend-Save
  });
</script>

  </body>
</html>
