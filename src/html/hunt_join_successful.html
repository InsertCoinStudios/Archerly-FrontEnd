<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="../css/style.css">
  </head>
  <body>
    <div class="header-bg">
          <img src="../img/return.png" class="header-img" id="returnBtn">
    </div>
    <div class="bg-wrapper">
    <div class="bg-dark">
    </div>
    <div class="bg-wrapper-2">
    <div class="bg-light">

    </div>
    </div>
    </div>
    <div class="container">
      <div class="bg-wrapper-header">
        <div class="header-hunt-join">
          <div id="hunt_join_outer_oval">
            <p>Du bist der</p>
            <div id="hunt_join_inner_oval">Jagd beigetreten!</div>
            <p>Gleich geht's los!</p>
          </div>
        </div>
      </div>
        <div class="session-box" style="margin-top: auto;">
          <div class="session-box-in">
            <h5 id="sessionIdDisplay">SESSION-ID:<br><br>#XXXX</h5>
            <!-- DYNAMISCHER WERT NICHT HARD GECODED WIE HIER -->
          </div>
        </div>
        <div class="content">
        <div class="table_users_queue" id="usersQueue">
          <!-- DYNAMISCHE ANPASSUNG: USERNAMEN, USERANZAHL -->
          <div class="non-collapse-top_queue">
            <p>User 1</p>
          </div>
          <div class="non-collapse_queue">
            <p>User 2</p>
          </div>
          <div class="non-collapse_queue">
            <p>User 3</p>
          </div>
          <div class="non-collapse_queue">
            <p>User 4</p>
          </div>
          <div class="non-collapse_queue">
            <p>User 5</p>
          </div>
          <div class="non-collapse_queue">
            <p>User 6</p>
          </div>
          <div class="non-collapse_queue">
            <p>User 7</p>
          </div>
          <div class="non-collapse-bottom_queue">
            <p>User 8</p>
          </div>
        </div>
        </div>
      <div class="footer">
      <!-- DYNAMISCHE TEILNEHMER ANZAHL MAX. 10-->
        <h5 style="color: #4f4e4e; margin-top: -10px;">
          Teilnehmer Anzahl:<br>8
        </h5>
        <!-- Sobald "Ersteller" fertig erstellt hat, dann zum Scoreboard rüber-->
        <a href="hunt_join_successful.html">
          <button disabled class="disabled-btn">Auf Host warten...</button>
        </a>
      </div>
    </div>
<div id="leaveOverlay">
  <div id="leaveModal">
    <h3><strong>Möchtest du diese<br>Jagd verlassen?</strong></h3>

    <div class="leave-actions">
      <button id="leaveYes">Ja</button>
      <button id="leaveNo">Nein</button>
    </div>
  </div>
</div>
<script>
  const returnBtn = document.getElementById("returnBtn");
  const overlay = document.getElementById("leaveOverlay");
  const yesBtn = document.getElementById("leaveYes");
  const noBtn = document.getElementById("leaveNo");

  returnBtn.addEventListener("click", () => {
    overlay.style.display = "flex";
  });

  yesBtn.addEventListener("click", () => {
    window.location.href = "index.html";
  });

  noBtn.addEventListener("click", () => {
    overlay.style.display = "none";
  });

  overlay.addEventListener("click", (e) => {
  if (e.target === overlay) {
    overlay.style.display = "none";
  }
});

</script>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const sessionIdDisplay = document.getElementById("sessionIdDisplay");
  const usersQueue = document.getElementById("usersQueue");

  try {
    // JWT-Token aus LocalStorage
    const token = localStorage.getItem("authToken");
    if (!token) throw new Error("Nicht eingeloggt");

    // Session-ID, die der User eingegeben hat oder aus URL
    const sessionId = localStorage.getItem("joinedSessionId"); // z.B. beim "Beitreten" speichern

    if (!sessionId) throw new Error("Keine Session-ID vorhanden");

    // === Session-Daten vom Backend abrufen ===
    const response = await fetch(`https://dein-backend-url/api/session/${sessionId}`, {
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${token}`
      }
    });

    if (!response.ok) throw new Error("Fehler beim Laden der Session");

    const data = await response.json();
    // Beispiel Rückgabe:
    // data = { sessionId: "1234", creator: {username: "CreatorUser"}, participants: [{username: "User1"}, ...] }

    // === Session-ID anzeigen ===
    sessionIdDisplay.innerHTML = `SESSION-ID:<br><br>#${data.sessionId}`;

    // === Teilnehmer anzeigen ===
    usersQueue.innerHTML = ""; // leeren
    data.participants.forEach((user, idx) => {
      const row = document.createElement("div");
      row.className = "non-collapse-queue";

      // Erster Eintrag = top, letzter Eintrag = bottom
      if (idx === 0) row.className = "non-collapse-top_queue";
      if (idx === data.participants.length - 1) row.className = "non-collapse-bottom_queue";

      row.innerHTML = `<p>${user.username}</p>`;

      // Wenn der User der Creator ist → Highlight
      if (user.username === data.creator.username) {
        row.style.backgroundColor = "#fbd279";
      }

      usersQueue.appendChild(row);
    });

  } catch (err) {
    console.error(err);
    alert("Fehler beim Laden der Session. Bitte erneut versuchen.");
  }
});
</script>

  </body>
</html>